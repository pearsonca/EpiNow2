<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Estimate Truncation of Observed Data — estimate_truncation • EpiNow2</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Estimate Truncation of Observed Data — estimate_truncation"><meta name="description" content="
Estimates a truncation distribution from multiple snapshots of the same
data source over time. This distribution can then be used passed to the
truncation argument in regional_epinow(), epinow(), and
estimate_infections() to adjust for truncated data and propagate the
uncertainty associated with data truncation into the estimates.
See here
for an example of using this approach on Covid-19 data in England. The
functionality offered by this function is now available in a more principled
manner in the epinowcast R package.
The model of truncation is as follows:
The truncation distribution is assumed to be discretised log normal wit
a mean and standard deviation that is informed by the data.
The data set with the latest observations is adjusted for truncation using
the truncation distribution.
Earlier data sets are recreated by applying the truncation distribution to
the adjusted latest observations in the time period of the earlier data set.
These data sets are then compared to the earlier observations assuming a
negative binomial observation model with an additive noise term to deal with
zero observations.


This model is then fit using stan with standard normal, or half normal,
prior for the mean, standard deviation, 1 over the square root of the
overdispersion and additive noise term.
This approach assumes that:
Current truncation is related to past truncation.
Truncation is a multiplicative scaling of underlying reported cases.
Truncation is log normally distributed.

"><meta property="og:description" content="
Estimates a truncation distribution from multiple snapshots of the same
data source over time. This distribution can then be used passed to the
truncation argument in regional_epinow(), epinow(), and
estimate_infections() to adjust for truncated data and propagate the
uncertainty associated with data truncation into the estimates.
See here
for an example of using this approach on Covid-19 data in England. The
functionality offered by this function is now available in a more principled
manner in the epinowcast R package.
The model of truncation is as follows:
The truncation distribution is assumed to be discretised log normal wit
a mean and standard deviation that is informed by the data.
The data set with the latest observations is adjusted for truncation using
the truncation distribution.
Earlier data sets are recreated by applying the truncation distribution to
the adjusted latest observations in the time period of the earlier data set.
These data sets are then compared to the earlier observations assuming a
negative binomial observation model with an additive noise term to deal with
zero observations.


This model is then fit using stan with standard normal, or half normal,
prior for the mean, standard deviation, 1 over the square root of the
overdispersion and additive noise term.
This approach assumes that:
Current truncation is related to past truncation.
Truncation is a multiplicative scaling of underlying reported cases.
Truncation is log normally distributed.

"><meta property="og:image" content="https://epiforecasts.io/EpiNow2/reference/figures/unnamed-chunk-14-1.png"><meta property="og:image:alt" content="Example estimates produced by EpiNow2 of the reproduction number, cases by date of infection and cases by date of report"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:creator" content="@seabbs"><meta name="twitter:site" content="@epiforecasts"><meta name="robots" content="noindex"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">EpiNow2</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">1.7.1.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/EpiNow2.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-model-definitions" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Model definitions</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-model-definitions"><li><a class="dropdown-item" href="../articles/estimate_infections.html">estimate_infections()</a></li>
    <li><a class="dropdown-item" href="../articles/estimate_secondary.html">estimate_secondary()</a></li>
    <li><a class="dropdown-item" href="../articles/estimate_truncation.html">estimate_truncation()</a></li>
    <li><a class="dropdown-item" href="../articles/gaussian_process_implementation_details.html">Gaussian Process implementation details</a></li>
  </ul></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-usage" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Usage</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-usage"><li><a class="dropdown-item" href="../articles/estimate_infections_workflow.html">Workflow for Rt estimation and forecasting</a></li>
    <li><a class="dropdown-item" href="../articles/estimate_infections_options.html">Examples: estimate_infections()</a></li>
    <li><a class="dropdown-item" href="../articles/epinow.html">Using epinow() for running in production mode</a></li>
    <li><a class="dropdown-item" href="../articles/forecasting_multiple_data_streams.html">Forecasting multiple data streams</a></li>
  </ul></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-case-studies" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Case studies</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-case-studies"><li><a class="dropdown-item" href="../articles/case-studies.html">External case studies and use in the literature</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/epiforecasts/EpiNow2/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Estimate Truncation of Observed Data</h1>
      <small class="dont-index">Source: <a href="https://github.com/epiforecasts/EpiNow2/blob/master/R/estimate_truncation.R" class="external-link"><code>R/estimate_truncation.R</code></a></small>
      <div class="d-none name"><code>estimate_truncation.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><a href="https://lifecycle.r-lib.org/articles/stages.html#stable" class="external-link"><img src="figures/lifecycle-stable.svg" alt="[Stable]"></a>
Estimates a truncation distribution from multiple snapshots of the same
data source over time. This distribution can then be used passed to the
<code>truncation</code> argument in <code><a href="regional_epinow.html">regional_epinow()</a></code>, <code><a href="epinow.html">epinow()</a></code>, and
<code><a href="estimate_infections.html">estimate_infections()</a></code> to adjust for truncated data and propagate the
uncertainty associated with data truncation into the estimates.</p>
<p>See <a href="https://gist.github.com/seabbs/176b0c7f83eab1a7192a25b28bbd116a" class="external-link">here</a>
for an example of using this approach on Covid-19 data in England. The
functionality offered by this function is now available in a more principled
manner in the <a href="https://package.epinowcast.org/" class="external-link"><code>epinowcast</code> R package</a>.</p>
<p>The model of truncation is as follows:</p><ol><li><p>The truncation distribution is assumed to be discretised log normal wit
a mean and standard deviation that is informed by the data.</p></li>
<li><p>The data set with the latest observations is adjusted for truncation using
the truncation distribution.</p></li>
<li><p>Earlier data sets are recreated by applying the truncation distribution to
the adjusted latest observations in the time period of the earlier data set.
These data sets are then compared to the earlier observations assuming a
negative binomial observation model with an additive noise term to deal with
zero observations.</p></li>
</ol><p>This model is then fit using <code>stan</code> with standard normal, or half normal,
prior for the mean, standard deviation, 1 over the square root of the
overdispersion and additive noise term.</p>
<p>This approach assumes that:</p><ul><li><p>Current truncation is related to past truncation.</p></li>
<li><p>Truncation is a multiplicative scaling of underlying reported cases.</p></li>
<li><p>Truncation is log normally distributed.</p></li>
</ul></div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">estimate_truncation</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  truncation <span class="op">=</span> <span class="fu"><a href="trunc_opts.html">trunc_opts</a></span><span class="op">(</span><span class="fu"><a href="Distributions.html">LogNormal</a></span><span class="op">(</span>meanlog <span class="op">=</span> <span class="fu"><a href="Distributions.html">Normal</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, sdlog <span class="op">=</span> <span class="fu"><a href="Distributions.html">Normal</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, max <span class="op">=</span></span>
<span>    <span class="fl">10</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  model <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  stan <span class="op">=</span> <span class="fu"><a href="stan_opts.html">stan_opts</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  CrIs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.5</span>, <span class="fl">0.9</span><span class="op">)</span>,</span>
<span>  filter_leading_zeros <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  zero_threshold <span class="op">=</span> <span class="cn">Inf</span>,</span>
<span>  weigh_delay_priors <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  <span class="va">obs</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>A list of <code>&lt;data.frame&gt;</code>s each containing a date variable
and a confirm (numeric) variable. Each data set should be a snapshot
of the reported data over time. All data sets must contain a complete vector
of dates.</p></dd>


<dt id="arg-truncation">truncation<a class="anchor" aria-label="anchor" href="#arg-truncation"></a></dt>
<dd><p>A call to <code><a href="trunc_opts.html">trunc_opts()</a></code> defining the truncation of
the observed data. Defaults to <code><a href="trunc_opts.html">trunc_opts()</a></code>, i.e. no truncation.  See the
<code>estimate_truncation()</code> help file for an approach to estimating this from
data where the <code>dist</code> list element returned by <code>estimate_truncation()</code> is
used as the <code>truncation</code> argument here, thereby propagating the uncertainty
in the estimate.</p></dd>


<dt id="arg-model">model<a class="anchor" aria-label="anchor" href="#arg-model"></a></dt>
<dd><p>A compiled stan model to override the default model. May be
useful for package developers or those developing extensions.</p></dd>


<dt id="arg-stan">stan<a class="anchor" aria-label="anchor" href="#arg-stan"></a></dt>
<dd><p>A list of stan options as generated by <code><a href="stan_opts.html">stan_opts()</a></code>. Defaults
to <code><a href="stan_opts.html">stan_opts()</a></code>. Can be used to override <code>data</code>, <code>init</code>, and <code>verbose</code>
settings if desired.</p></dd>


<dt id="arg-cris">CrIs<a class="anchor" aria-label="anchor" href="#arg-cris"></a></dt>
<dd><p>Numeric vector of credible intervals to calculate.</p></dd>


<dt id="arg-filter-leading-zeros">filter_leading_zeros<a class="anchor" aria-label="anchor" href="#arg-filter-leading-zeros"></a></dt>
<dd><p>Logical, defaults to TRUE. Should zeros at the
start of the time series be filtered out.</p></dd>


<dt id="arg-zero-threshold">zero_threshold<a class="anchor" aria-label="anchor" href="#arg-zero-threshold"></a></dt>
<dd><p><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental" class="external-link"><img src="figures/lifecycle-experimental.svg" alt="[Experimental]"></a> Numeric defaults
to Inf. Indicates if detected zero cases are meaningful by using a threshold
number of cases based on the 7-day average. If the average is above this
threshold then the zero is replaced using <code>fill</code>.</p></dd>


<dt id="arg-weigh-delay-priors">weigh_delay_priors<a class="anchor" aria-label="anchor" href="#arg-weigh-delay-priors"></a></dt>
<dd><p>Deprecated; use the <code>weight_prior</code> option in
<code><a href="trunc_opts.html">trunc_opts()</a></code> instead.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>Logical, should model fitting progress be returned.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Additional parameters to pass to <code><a href="https://mc-stan.org/rstan/reference/stanmodel-method-sampling.html" class="external-link">rstan::sampling()</a></code>.</p></dd>


<dt id="arg-obs">obs<a class="anchor" aria-label="anchor" href="#arg-obs"></a></dt>
<dd><p>Deprecated; use <code>data</code> instead.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A list containing: the summary parameters of the truncation
distribution (<code>dist</code>), which could be passed to the <code>truncation</code> argument
of <code><a href="epinow.html">epinow()</a></code>, <code><a href="regional_epinow.html">regional_epinow()</a></code>, and <code><a href="estimate_infections.html">estimate_infections()</a></code>, the
estimated CMF of the truncation distribution (<code>cmf</code>, can be used to
adjusted new data), a <code>&lt;data.frame&gt;</code> containing the observed truncated
data, latest observed data and the adjusted for
truncation observations (<code>obs</code>), a <code>&lt;data.frame&gt;</code> containing the last
observed data (<code>last_obs</code>, useful for plotting and validation), the data
used for fitting (<code>data</code>) and the fit object (<code>fit</code>).</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="co"># set number of cores to use</span></span></span>
<span class="r-in"><span><span class="va">old_opts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>mc.cores <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/interactive.html" class="external-link">interactive</a></span><span class="op">(</span><span class="op">)</span>, <span class="fl">4</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># fit model to example data</span></span></span>
<span class="r-in"><span><span class="co"># See [example_truncated] for more details</span></span></span>
<span class="r-in"><span><span class="va">est</span> <span class="op">&lt;-</span> <span class="fu">estimate_truncation</span><span class="op">(</span><span class="va">example_truncated</span>,</span></span>
<span class="r-in"><span>  verbose <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/interactive.html" class="external-link">interactive</a></span><span class="op">(</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  chains <span class="op">=</span> <span class="fl">2</span>, iter <span class="op">=</span> <span class="fl">2000</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> WARN [2025-03-01 01:52:14] estimate_truncation (chain: 1): There were 10 divergent transitions after warmup. See</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> https://mc-stan.org/misc/warnings.html#divergent-transitions-after-warmup</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> to find out why this is a problem and how to eliminate them. - </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> WARN [2025-03-01 01:52:14] estimate_truncation (chain: 1): Examine the pairs() plot to diagnose sampling problems</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># summary of the distribution</span></span></span>
<span class="r-in"><span><span class="va">est</span><span class="op">$</span><span class="va">dist</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - lognormal distribution (max: 10):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   meanlog:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     - normal distribution:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       mean:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         -1.9</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       sd:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         0.46</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   sdlog:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     - normal distribution:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       mean:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         2.2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       sd:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         0.66</span>
<span class="r-in"><span><span class="co"># summary of the estimated truncation cmf (can be applied to new data)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">est</span><span class="op">$</span><span class="va">cmf</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     index      mean      se_mean           sd  lower_90  lower_50  lower_20</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     &lt;int&gt;     &lt;num&gt;        &lt;num&gt;        &lt;num&gt;     &lt;num&gt;     &lt;num&gt;     &lt;num&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  1:     1 1.0000000 2.868849e-18 1.273934e-16 1.0000000 1.0000000 1.0000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  2:     2 0.9972753 4.514903e-05 1.509180e-03 0.9945940 0.9962185 0.9969473</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  3:     3 0.9939811 9.660325e-05 3.228858e-03 0.9882674 0.9916965 0.9932484</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  4:     4 0.9899092 1.558923e-04 5.210631e-03 0.9807389 0.9861973 0.9887055</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  5:     5 0.9847324 2.250755e-04 7.524563e-03 0.9718232 0.9793838 0.9829247</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  6:     6 0.9779032 3.069497e-04 1.026728e-02 0.9604877 0.9707168 0.9753269</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  7:     7 0.9684230 4.052489e-04 1.357207e-02 0.9458148 0.9590183 0.9648448</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  8:     8 0.9542338 5.239514e-04 1.761111e-02 0.9255068 0.9421863 0.9493498</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  9:     9 0.9301862 6.599340e-04 2.250936e-02 0.8944398 0.9149302 0.9241066</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10:    10 0.8775009 7.111290e-04 2.747865e-02 0.8351377 0.8587945 0.8699125</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11:    11 0.4201200 3.822738e-04 1.565393e-02 0.3965888 0.4095389 0.4158845</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        median  upper_20  upper_50  upper_90</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         &lt;num&gt;     &lt;num&gt;     &lt;num&gt;     &lt;num&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  1: 1.0000000 1.0000000 1.0000000 1.0000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  2: 0.9973828 0.9977871 0.9984367 0.9995866</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  3: 0.9941755 0.9950177 0.9964247 0.9989926</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  4: 0.9901591 0.9915443 0.9938176 0.9981254</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  5: 0.9849896 0.9870101 0.9902510 0.9967929</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  6: 0.9780120 0.9807912 0.9852898 0.9946402</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  7: 0.9683102 0.9719617 0.9778383 0.9908507</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  8: 0.9538794 0.9584895 0.9660560 0.9843506</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  9: 0.9291598 0.9348722 0.9442827 0.9685577</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10: 0.8761752 0.8827219 0.8941617 0.9228567</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11: 0.4193444 0.4230904 0.4295957 0.4459676</span>
<span class="r-in"><span><span class="co"># observations linked to truncation adjusted estimates</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">est</span><span class="op">$</span><span class="va">obs</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           date confirm last_confirm report_date  mean se_mean    sd lower_90</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         &lt;Date&gt;   &lt;num&gt;        &lt;num&gt;      &lt;Date&gt; &lt;int&gt;   &lt;int&gt; &lt;int&gt;    &lt;int&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  1: 2020-03-24    4764         4789  2020-04-01  5244       0    27     5200</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  2: 2020-03-25    5191         5249  2020-04-01  5181       1    39     5118</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  3: 2020-03-26    5102         5210  2020-04-01  6058       1    63     5955</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  4: 2020-03-27    5924         6153  2020-04-01  5749       2    80     5618</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  5: 2020-03-28    5567         5959  2020-04-01  5544       3   102     5373</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  6: 2020-03-29    5289         5974  2020-04-01  4499       3   108     4318</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  7: 2020-03-30    4183         5217  2020-04-01  3043       2    94     2891</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  8: 2020-03-31    2668         4050  2020-04-01  4006       3   147     3769</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  9: 2020-04-01    1681         4053  2020-04-01     0      NA     0        0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10: 2020-03-29    5970         5974  2020-04-06  6006       0    19     5976</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11: 2020-03-30    5209         5217  2020-04-06  5262       0    27     5218</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 12: 2020-03-31    4035         4050  2020-04-06  4097       0    31     4047</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13: 2020-04-01    4020         4053  2020-04-06  4111       1    43     4041</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 14: 2020-04-02    4697         4782  2020-04-06  4851       2    68     4740</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 15: 2020-04-03    4483         4668  2020-04-06  4699       2    86     4554</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 16: 2020-04-04    4182         4585  2020-04-06  4498       3   108     4317</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17: 2020-04-05    3864         4805  2020-04-06  4407       3   136     4186</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 18: 2020-04-06    2420         4316  2020-04-06  5768       5   212     5426</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 19: 2020-04-03    4653         4668  2020-04-11  4681       0    15     4657</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 20: 2020-04-04    4554         4585  2020-04-11  4600       0    24     4562</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 21: 2020-04-05    4741         4805  2020-04-11  4814       1    36     4756</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 22: 2020-04-06    4208         4316  2020-04-11  4303       1    45     4230</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 23: 2020-04-07    3431         3599  2020-04-11  3543       1    49     3462</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 24: 2020-04-08    2779         3039  2020-04-11  2913       1    53     2823</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 25: 2020-04-09    3234         3836  2020-04-11  3478       2    83     3338</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 26: 2020-04-10    2993         4204  2020-04-11  3414       2   106     3243</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 27: 2020-04-11    1848         3951  2020-04-11  4404       3   162     4143</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 28: 2020-04-08    3036         3039  2020-04-16  3054       0     9     3039</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 29: 2020-04-09    3829         3836  2020-04-16  3868       0    20     3836</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 30: 2020-04-10    4187         4204  2020-04-16  4252       0    32     4200</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 31: 2020-04-11    3916         3951  2020-04-16  4004       1    42     3937</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 32: 2020-04-12    4605         4686  2020-04-16  4756       1    66     4647</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 33: 2020-04-13    3925         4074  2020-04-16  4114       2    75     3987</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 34: 2020-04-14    2873         3124  2020-04-16  3090       2    74     2966</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 35: 2020-04-15    2393         2919  2020-04-16  2729       2    84     2593</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 36: 2020-04-16    1512         2580  2020-04-16  3603       3   132     3390</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 37: 2020-04-13    4074         4074  2020-04-21  4098       0    13     4078</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 38: 2020-04-14    3124         3124  2020-04-21  3155       0    16     3129</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 39: 2020-04-15    2919         2919  2020-04-21  2964       0    22     2928</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 40: 2020-04-16    2580         2580  2020-04-21  2638       0    27     2593</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 41: 2020-04-17    3563         3563  2020-04-21  3679       1    51     3595</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 42: 2020-04-18    3126         3126  2020-04-21  3277       1    60     3175</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 43: 2020-04-19    2843         2843  2020-04-21  3058       2    73     2935</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 44: 2020-04-20    2051         2051  2020-04-21  2339       1    72     2222</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 45: 2020-04-21     962          962  2020-04-21  2292       1    84     2157</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           date confirm last_confirm report_date  mean se_mean    sd lower_90</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     lower_50 lower_20 median upper_20 upper_50 upper_90</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        &lt;int&gt;    &lt;int&gt;  &lt;int&gt;    &lt;int&gt;    &lt;int&gt;    &lt;int&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  1:     5223     5235   5242     5250     5263     5292</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  2:     5152     5169   5179     5190     5209     5249</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  3:     6012     6040   6057     6073     6102     6167</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  4:     5693     5727   5749     5769     5804     5885</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  5:     5474     5518   5544     5571     5613     5714</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  6:     4429     4474   4501     4526     4571     4676</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  7:     2983     3022   3045     3066     3106     3194</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  8:     3912     3973   4008     4041     4104     4238</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  9:        0        0      0        0        0        0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10:     5991     5999   6004     6010     6019     6040</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11:     5241     5253   5260     5268     5281     5311</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 12:     4074     4088   4096     4105     4119     4151</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13:     4080     4098   4110     4121     4141     4185</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 14:     4803     4832   4850     4868     4897     4966</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 15:     4640     4677   4699     4722     4758     4843</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 16:     4428     4473   4500     4525     4570     4675</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17:     4321     4377   4410     4441     4499     4626</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 18:     5633     5719   5770     5818     5909     6102</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 19:     4669     4676   4680     4684     4691     4708</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 20:     4582     4592   4599     4606     4617     4643</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 21:     4787     4803   4813     4823     4840     4878</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 22:     4270     4290   4302     4314     4334     4381</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 23:     3508     3529   3543     3556     3577     3627</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 24:     2876     2899   2913     2927     2949     3002</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 25:     3424     3459   3480     3499     3534     3615</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 26:     3347     3390   3415     3440     3485     3583</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 27:     4301     4367   4406     4443     4512     4659</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 28:     3046     3051   3053     3056     3061     3072</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 29:     3852     3861   3867     3872     3882     3904</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 30:     4228     4242   4250     4259     4275     4308</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 31:     3974     3992   4004     4015     4034     4077</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 32:     4709     4737   4755     4772     4801     4868</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 33:     4062     4094   4114     4134     4165     4240</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 34:     3042     3073   3092     3108     3140     3212</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 35:     2676     2710   2731     2750     2786     2865</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 36:     3519     3573   3605     3635     3691     3812</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 37:     4088     4094   4097     4101     4108     4122</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 38:     3143     3150   3155     3159     3167     3185</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 39:     2947     2957   2963     2969     2980     3003</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 40:     2618     2630   2638     2645     2657     2686</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 41:     3643     3665   3679     3692     3715     3767</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 42:     3235     3261   3277     3292     3317     3377</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 43:     3010     3041   3059     3076     3107     3178</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 44:     2293     2323   2340     2357     2388     2455</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 45:     2239     2273   2294     2313     2348     2425</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     lower_50 lower_20 median upper_20 upper_50 upper_90</span>
<span class="r-in"><span><span class="co"># validation plot of observations vs estimates</span></span></span>
<span class="r-in"><span><span class="fu"><a href="plot.estimate_infections.html">plot</a></span><span class="op">(</span><span class="va">est</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="estimate_truncation-1.png" alt="" width="864" height="864"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Pass the truncation distribution to `epinow()`.</span></span></span>
<span class="r-in"><span><span class="co"># Note, we're using the last snapshot as the observed data as it contains</span></span></span>
<span class="r-in"><span><span class="co"># all the previous snapshots. Also, we're using the default options for</span></span></span>
<span class="r-in"><span><span class="co"># illustrative purposes only.</span></span></span>
<span class="r-in"><span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="epinow.html">epinow</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  generation_time <span class="op">=</span> <span class="fu"><a href="generation_time_opts.html">generation_time_opts</a></span><span class="op">(</span><span class="va">example_generation_time</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="va">example_truncated</span><span class="op">[[</span><span class="fl">5</span><span class="op">]</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>  truncation <span class="op">=</span> <span class="fu"><a href="trunc_opts.html">trunc_opts</a></span><span class="op">(</span><span class="va">est</span><span class="op">$</span><span class="va">dist</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Logging threshold set at INFO for the name logger</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Writing <span style="color: #0000BB;">EpiNow2</span> logs to the console and:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #0000BB;">/tmp/RtmpR300Ld/regional-epinow/2020-04-21.log</span>.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Logging threshold set at INFO for the name logger</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Writing <span style="color: #0000BB;">EpiNow2.epinow</span> logs to the console and:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #0000BB;">/tmp/RtmpR300Ld/epinow/2020-04-21.log</span>.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> WARN [2025-03-01 01:55:11] epinow: There were 4 divergent transitions after warmup. See</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> https://mc-stan.org/misc/warnings.html#divergent-transitions-after-warmup</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> to find out why this is a problem and how to eliminate them. - </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> WARN [2025-03-01 01:55:11] epinow: Examine the pairs() plot to diagnose sampling problems</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - </span>
<span class="r-in"><span><span class="fu"><a href="plot.estimate_infections.html">plot</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="estimate_truncation-2.png" alt="" width="864" height="864"></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span><span class="va">old_opts</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://www.samabbott.co.uk/" class="external-link">Sam Abbott</a>, Joel Hellewell, Katharine Sherratt, Katelyn Gostic, Joe Hickson, Hamada S. Badr, Michael DeWitt, James M. Azam, EpiForecasts, <a href="https://www.lshtm.ac.uk/aboutus/people/funk.sebastian" class="external-link">Sebastian Funk</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

